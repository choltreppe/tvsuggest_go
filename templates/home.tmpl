{{define "body"}}

  <div id="head-bar"><div class="box">
    <div class="suggestions" onclick="loadSuggestions()">Suggestions</div>
    <div class="rating">
      <div class="bad"     onclick="loadRating(this, -1)"></div>
      <div class="neutral" onclick="loadRating(this,  0)"></div>
      <div class="good"    onclick="loadRating(this,  1)"></div>
      <div class="better"  onclick="loadRating(this,  2)"></div>
    </div>
    <form class="search" onsubmit="searchShow()">
      <input type="text" placeholder="Search Movie or TV-Show">
      <input type="submit" value="">
    </form>
  </div></div>
  
  <button id="logout" onclick="logout()"></button>
  
  <div id="content"></div>

  <script type="text/javascript">
    
    let content = document.getElementById("content")
    let suggestionsButton = document.querySelector("#head-bar .suggestions")
    let ratingTabs = document.querySelector("#head-bar .rating").children
    let searchBar = document.querySelector('#head-bar .search > input[type="text"]')
    let searchSubmit = document.querySelector('#head-bar .search > input[type="submit"]')

    function unselectMenu() {
      suggestionsButton.classList.remove("selected")
      searchSubmit.classList.remove("selected")
      for (rating of ratingTabs) {
        rating.classList.remove("selected")
      }
    }

    function loadContent(url) {
      unselectMenu()
      content.innerHTML = '<div class="loading" title="logout"></div>'
      fetch(url)
      .then(resp => resp.text())
      .then(resp => content.innerHTML = resp)
    }

    function loadSuggestions() {
      loadContent('/suggestions')
      suggestionsButton.classList.add("selected")
    }

    function searchShow() {
      event.preventDefault()
      loadContent('/search/' + encodeURIComponent(searchBar.value))
      searchSubmit.classList.add("selected")
    }

    function loadRating(elem, score) {
      searchBar.value = ""
      loadContent(`/my-ratings/${score}`)
      elem.classList.add("selected")
    }

    function rateShow(elem, id, score) {
      fetch(`/rate/${encodeURIComponent(id)}/${score}`, {method: "POST"})
      .then(resp => {
        if (resp.status == 200) {
          if (searchSubmit.classList.contains("selected")) {
            for (rating of elem.parentNode.children) {
              rating.classList.remove("selected")
            }
            elem.classList.add("selected")
          } else {
            elem.parentNode.parentNode.remove()
          }
        }
      })
    }

    function logout() {
      document.cookie = "session=;expires=Thu, 01 Jan 1970 00:00:01 GMT"
      window.location.href = "/login"
    }

  </script>

{{end}}