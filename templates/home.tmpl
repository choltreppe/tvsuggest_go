{{define "body"}}

  <div id="head-bar"><div class="box">
    <div class="suggestions" onclick="loadSuggestions()">Suggestions</div>
    <div class="rating">
      <div class="bad"     onclick="loadRating(this, -1)"></div>
      <div class="neutral" onclick="loadRating(this,  0)"></div>
      <div class="good"    onclick="loadRating(this,  1)"></div>
      <div class="better"  onclick="loadRating(this,  2)"></div>
    </div>
    <form class="search" onsubmit="searchShow()">
      <input type="text" placeholder="Search Movie or TV-Show">
      <input type="submit" value="">
    </form>
  </div></div>
  
  <button id="logout" onclick="logout()"></button>
  
  <div class="loading hidden"></div>
  <div id="content"></div>

  <script type="text/javascript">
    
    const content = document.getElementById("content")
    const suggestionsButton = document.querySelector("#head-bar .suggestions")
    const ratingTabs = document.querySelector("#head-bar .rating").children
    const searchBar = document.querySelector('#head-bar .search > input[type="text"]')
    const searchSubmit = document.querySelector('#head-bar .search > input[type="submit"]')
    const loading = document.querySelector("body > .loading")

    function unselectMenu() {
      suggestionsButton.classList.remove("selected")
      searchSubmit.classList.remove("selected")
      for (rating of ratingTabs) {
        rating.classList.remove("selected")
      }
    }

    function loadContent(url) {
      unselectMenu()
      loading.classList.remove("hidden")
      content.className = "out"
      const timer = new Promise(resolve => setTimeout(resolve, 400))
      const req = fetch(url).then(resp => resp.text())
      Promise.all([timer, req])
      .then(([_, resp]) => {
        content.innerHTML = resp
        content.className = "in"
      })
    }

    function loadSuggestions() {
      loadContent('/suggestions')
      suggestionsButton.classList.add("selected")
    }

    function searchShow() {
      event.preventDefault()
      loadContent('/search/' + encodeURIComponent(searchBar.value))
      searchSubmit.classList.add("selected")
    }

    function loadRating(elem, score) {
      searchBar.value = ""
      loadContent(`/my-ratings/${score}`)
      elem.classList.add("selected")
    }

    function rateShow(elem, id, score) {
      fetch(`/rate/${encodeURIComponent(id)}/${score}`, {method: "POST"})
      .then(resp => {
        if (resp.status == 200) {
          if (searchSubmit.classList.contains("selected")) {
            for (rating of elem.parentNode.children) {
              rating.classList.remove("selected")
            }
            elem.classList.add("selected")
          } else {
            elem.parentNode.parentNode.remove()
          }
        }
      })
    }

    function logout() {
      document.cookie = "session=;expires=Thu, 01 Jan 1970 00:00:01 GMT"
      window.location.href = "/login"
    }

  </script>

{{end}}